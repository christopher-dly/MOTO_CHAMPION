{% extends "layout.html.twig" %}

{% block main %}
    <div class='home'>
        <div class="carousel-container">
            <div class="carousel-slide" id="carousel-slide">
                {% for actuality in actualitys %}
                    <div class="carousel-item">
                        <div class='actuality-img'>
                            {% if actuality.image %}
                                <img src="{{ asset('uploads/' ~ actuality.image) }}" alt="image de l'actualité">
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="pagination" id="carousel-pagination"></div>
        </div>

        <div class="new_vehicle_filter_form_container">
            {{ form_start(indexFilterForm) }}

            <div class='new_vehicle_filter_form_input_container'>
                {{ form_widget(indexFilterForm.type, { attr: { class: 'new_vehicle_filter_form_input' }}) }}
                {{ form_errors(indexFilterForm.type) }}

                {{ form_widget(indexFilterForm.category, { attr: { class: 'new_vehicle_filter_form_input' }}) }}
                {{ form_errors(indexFilterForm.category) }}

                {{ form_widget(indexFilterForm.price, { attr: { class: 'new_vehicle_filter_form_input' }}) }}
                {{ form_errors(indexFilterForm.price) }}

                {{ form_widget(indexFilterForm.cylinders, { attr: { class: 'new_vehicle_filter_form_input' }}) }}
                {{ form_errors(indexFilterForm.cylinders) }}
            </div>

            <div class='new_vehicle_filter_form_input_checkbox_container'>
                <p>A2 :</p>
                {{ form_widget(indexFilterForm.A2, { attr: { class: 'new_vehicle_filter_form_input_checkbox' }}) }}
                {{ form_errors(indexFilterForm.A2) }}
            </div>

            <div class="new_vehicle_filter_form_button_container">
                {{ form_widget(indexFilterForm.submit) }}
            </div>

            {{ form_end(indexFilterForm) }}
        </div>

        <div class='home-results'>
            {% if vehicles is defined %}
                {% if vehicles is empty %}
                    {% if indexFilterForm.vars.submitted %}
                        <p>Aucun véhicule ne correspond aux critères sélectionnés.</p>
                    {% else %}
                        <p>Utilisez les filtres ci-dessus pour trouver le véhicule qui vous correspond.</p>
                    {% endif %}
                {% else %}
                    <ul class="vehicle_card_list">
                        {% for vehicle in vehicles %}
                            {# ---------- CARTE VÉHICULE NEUF ---------- #}
                            {% if vehicle.information is defined and vehicle.information is not null %}
                                <li class='new_vehicle_card'>
                                    <a href="{{ path('NewVehicleDetail', {id: vehicle.id}) }}">
                                        {% set logoClass = vehicle.information.brand == 'Suzuki'
                                            ? 'logo-suz'
                                            : (vehicle.information.brand == 'Kymco' ? 'logo-kymco' : '')
                                        %}
                                        <div class="new_vehicle_card_header {{ logoClass }}">
                                            <p class='new_vehicle_card_header_name'>{{ vehicle.name }}</p>
                                        </div>
                                        <div class='new_vehicle_card_image_container'>
                                            {% set images = vehicle.newVehicleImages %}
                                            {% if images|length > 0 %}
                                                <img class='new_vehicle_card_image'
                                                    src="{{ asset('uploads/' ~ images[0].image) }}"
                                                    alt="image du véhicule {{ vehicle.name }}">
                                            {% else %}
                                                <p>Pas d'image</p>
                                            {% endif %}
                                        </div>
                                        {% if vehicle.information.a2 %}
                                            <div class='new_vehicle_card_footer_logo_license'>
                                                <img class='new_vehicle_card_footer_logo' src='{{ asset('img/logo/logo_a.png') }}' alt='logo permis A'>
                                                <img class='new_vehicle_card_footer_logo' src='{{ asset('img/logo/logo_a2.png') }}' alt='logo permis A2'>
                                            </div>
                                        {% endif %}
                                        <div class='new_vehicle_card_footer'>
                                            <p class='new_vehicle_card_footer_price'>{{ vehicle.information.price }} €</p>
                                        </div>
                                    </a>
                                </li>
                            {% else %}
                                {# ---------- CARTE VÉHICULE D'OCCASION ---------- #}
                                {% if vehicle.isSelled == false %}
                                <li class="used_vehicle_card">
                                    <a class="used_vehicle_card_link" href="{{ path('UsedVehicleDetails', {id: vehicle.id}) }}">
                                        <div class="used_vehicle_card_header">
                                            <p class='used_vehicle_card_header_name'>{{ vehicle.brand }} - {{ vehicle.model }}</p>
                                        </div>
                                        <div class='used_vehicle_card_image_container'>
                                            {% set images = vehicle.usedVehicleImages %}
                                            {% if images|length > 0 %}
                                                <img class='used_vehicle_card_image'
                                                    src="{{ asset('uploads/' ~ images[0].image) }}"
                                                    alt="image du véhicule {{ vehicle.brand }}"
                                                    width="350" height="225">
                                            {% else %}
                                                <p>Pas d'image</p>
                                            {% endif %}
                                            {% if vehicle.a2 %}
                                                <div class='used_vehicle_card_footer_logo_license'>
                                                    <img class='used_vehicle_card_footer_logo' src='{{ asset('img/logo/logo_a.png') }}' alt='logo permis A'>
                                                    <img class='used_vehicle_card_footer_logo' src='{{ asset('img/logo/logo_a2.png') }}' alt='logo permis A2'>
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class='used_vehicle_card_footer_price'>
                                            <p class='used_vehicle_card_footer_price'>{{ vehicle.price }} €</p>
                                        </div>
                                        <div class='used_vehicle_card_footer_description'>
                                            <p class='used_vehicle_card_footer_year'>{{ vehicle.year }}</p>
                                            <p class='used_vehicle_card_footer_kilometers'>{{ vehicle.kilometers }} km</p>
                                        </div>
                                    </a>
                                </li>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </ul>
                {% endif %}
            {% else %}
                <p>Utilisez les filtres ci-dessus pour trouver le véhicule qui vous correspond.</p>
            {% endif %}
        </div>
    </div>

    <script>
        const slideContainer = document.getElementById('carousel-slide');
        const items = slideContainer.querySelectorAll('.carousel-item');
        const pagination = document.getElementById('carousel-pagination');
        const total = items.length;
        let current = 0;
        let interval = null;

        for (let i = 0; i < total; i++) {
            const dot = document.createElement('span');
            dot.dataset.index = i;
            if (i === 0) dot.classList.add('active');
            pagination.appendChild(dot);
        }

        const dots = pagination.querySelectorAll('span');

        function goToSlide(index) {
            current = index;
            slideContainer.style.transform = `translateX(-${100 * index}%)`;
            dots.forEach(dot => dot.classList.remove('active'));
            dots[index].classList.add('active');
        }

        function nextSlide() {
            current = (current + 1) % total;
            goToSlide(current);
        }

        dots.forEach(dot => {
            dot.addEventListener('click', () => {
                clearInterval(interval);
                goToSlide(+dot.dataset.index);
                startAutoSlide();
            });
        });

        function startAutoSlide() {
            interval = setInterval(nextSlide, 5000);
        }

        startAutoSlide();
    </script>
{% endblock %}
