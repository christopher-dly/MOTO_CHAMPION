{% extends 'layout.html.twig' %}

{% block main %}
    <h1 class='new_vehicle_detail_title_page'>{{vehicle.name}}</h1>
    <div class='new_vehicle_detail_card'>
        <div class='new_vehicle_detail_card_title_container'>
            <p class='new_vehicle_detail_card_title'>{{vehicle.name}}</p>
        </div>
        <div class='new_vehicle_detail_card_global_container'>
            <div class='new_vehicle_detail_card_image_container'>
                <div class='new_vehicle_detail_card_carrousel_container'>
                    <div class="new_vehicle_detail_carousel">
                        <div class="new_vehicle_detail_carousel-track">
                            {% for image in images %}
                                <div class="new_vehicle_detail_carousel-slide" data-color="{{ image.color|lower }}">
                                    <img src="{{ asset('uploads/' ~ image.image) }}" alt="Image véhicule">
                                </div>
                            {% endfor %}
                        </div>
                        <button class="new_vehicle_detail_carousel-btn prev">&#10094;</button>
                        <button class="new_vehicle_detail_carousel-btn next">&#10095;</button>
                    </div>
                </div>
                <div class='new_vehicle_detail_card_image_color'>
                    {% for name, hex in colors %}
                        <span class="new_vehicle_detail_color-dot" title="{{ name }}" style="background-color: {{ hex }};" data-color="{{ name }}"></span>
                    {% endfor %}
                </div>
            </div>
            <div class='new_vehicle_detail_card_info_container'>
                <p>Catégorie : {{vehicle.information.category}}</p>
                <p>Cylindrées : {{vehicle.information.cylinders}}</p>
                <p>Prix : {{vehicle.information.price}} €</p>
                <p>Temps de garantie : {{vehicle.information.warrantyTime}} an(s)</p>
                {% if vehicle.information.availableForTrial %}
                    <a href="{{ path('Home') }}">Réserver un essai</a>
                {% else %}
                    <a class="disabled-link">Réserver un essai</a>
                {% endif %}
                <img>
            </div>
        </div>
    </div>

   
<script>
document.addEventListener('DOMContentLoaded', () => {
    const track = document.querySelector('.new_vehicle_detail_carousel-track');
    const allSlides = Array.from(document.querySelectorAll('.new_vehicle_detail_carousel-slide'));
    const prevBtn = document.querySelector('.new_vehicle_detail_carousel-btn.prev');
    const nextBtn = document.querySelector('.new_vehicle_detail_carousel-btn.next');
    const colorDots = document.querySelectorAll('.new_vehicle_detail_color-dot');

    let currentColor = null;
    let visibleSlides = [...allSlides];
    let index = 0;

    function updateVisibleSlides() {
        visibleSlides = currentColor
            ? allSlides.filter(slide => slide.dataset.color === currentColor)
            : [...allSlides];

        // Masquer toutes les slides
        allSlides.forEach(slide => slide.style.display = 'none');

        // Afficher uniquement les slides filtrées
        visibleSlides.forEach(slide => slide.style.display = 'block');

        // Reset index et mise à jour du carrousel
        index = 0;
        updateCarousel();

        // Mise à jour de la classe active sur les pastilles
        colorDots.forEach(dot => {
            if (currentColor && dot.dataset.color.toLowerCase() === currentColor) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }

    function updateCarousel() {
        if (visibleSlides.length === 0) return;
        const slideWidth = visibleSlides[0].getBoundingClientRect().width;
        track.style.transform = `translateX(-${index * slideWidth}px)`;
    }

    nextBtn.addEventListener('click', () => {
        if (visibleSlides.length === 0) return;
        index = (index + 1) % visibleSlides.length;
        updateCarousel();
    });

    prevBtn.addEventListener('click', () => {
        if (visibleSlides.length === 0) return;
        index = (index - 1 + visibleSlides.length) % visibleSlides.length;
        updateCarousel();
    });

    colorDots.forEach(dot => {
        dot.addEventListener('click', () => {
            const selected = dot.dataset.color.toLowerCase();
            currentColor = (currentColor === selected) ? null : selected; // toggle filtre
            updateVisibleSlides();
        });
    });

    window.addEventListener('resize', updateCarousel);

    // Initialisation
    updateVisibleSlides();
});
</script>


{% endblock %}  